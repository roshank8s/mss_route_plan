<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <data>

        <!-- List view for Traktop -->
        <!-- List view for Traktop -->
        <record id="view_traktop_list" model="ir.ui.view">
            <field name="name">traktop.list</field>
            <field name="model">traktop</field>
            <field name="arch" type="xml">
                <list editable="top" create="false" delete="1" multi_edit="1">
                    <field name="delivery_order_id" widget="many2one_button"/>
                    <field name="partner_id"/>
                    <field name="delivery_address"/>
                    <field name="vehicle_starting_point"/>
                    <field name="vehicle_id"/>
                    <field name="driver_name"/>
                    <field name="is_manual" widget="boolean"/>
                    <button name="action_view_delivery_order" type="object" string="View"/>
                </list>
            </field>
        </record>


        <!-- Search view for Traktop -->
        <record id="view_traktop_search" model="ir.ui.view">
            <field name="name">traktop.search</field>
            <field name="model">traktop</field>
            <field name="arch" type="xml">
                <search string="Traktop">
                    <field name="delivery_order_id"/>
                    <field name="partner_id"/>
                    <separator/>
                    <filter string="Delivery Date Range" name="delivery_date_range"
                            domain="[('delivery_date', '>=', context_today().strftime('%Y-%m-%d'))]"
                            date="delivery_date"/>
                    <group expand="0" string="Group By" colspan="16">
                        <filter string="Delivery Date" name="group_by_delivery_date" context="{'group_by':'delivery_date'}"/>
                        <filter string="Customer" name="group_by_partner_id" context="{'group_by':'partner_id'}"/>
                        <filter string="Vehicle" name="group_by_vehicle_id" context="{'group_by':'vehicle_id'}"/>
                    </group>
                </search>
            </field>
        </record>



        <!-- Map view for Traktop -->
        <record id="traktop_map_view" model="ir.ui.view">
            <field name="name">traktop.map.view</field>
            <field name="model">traktop</field>
            <field name="arch" type="xml">
                <form string="Traktop Map View">
                    <sheet>
                        <group>
                            <field name="partner_id"/>
                            <field name="delivery_order_id"/>
                            <field name="display_name" readonly="1"/>
                            <field name="vehicle_id" widget="selection"/>
                        </group>
                        <notebook>
                            <page string="Delivery Orders">
                                <list>
                                    <field name="delivery_order_id"/>
                                    <field name="partner_id"/>
                                    <field name="vehicle_id"/>
                                </list>
                            </page>
                        </notebook>
                    </sheet>
                </form>
            </field>
        </record>

        <!-- Action for Traktop List view -->
        <record id="action_traktop" model="ir.actions.act_window">
            <field name="name">Delivery Orders</field>
            <field name="res_model">traktop</field>
            <field name="view_mode">list,form</field>
            <field name="domain">[('delivery_order_id', '!=', False)]</field>
            <field name="context">{'search_default_group_by_vehicle_id': 1}</field>
        </record>

        <!-- Action for Map view -->
        <record id="action_traktop_map" model="ir.actions.act_window">
            <field name="name">Route Optimization Map</field>
            <field name="res_model">traktop</field>
            <field name="view_mode">form</field>
            <field name="domain">[('vehicle_id', '=', active_id)]</field>
        </record>

        <!-- Server action to trigger optimization -->
        <record id="action_optimized_rec_created" model="ir.actions.server">
            <field name="name">Optimize Records</field>
            <field name="model_id" ref="model_traktop"/>
            <field name="state">code</field>
            <field name="code">
                action = model.sudo().get_optimized_rec_created()
            </field>
        </record>


        <!-- Read-only Map Form View using the multiple markers widget -->
        <record id="view_traktop_multiple_markers_form" model="ir.ui.view">
            <field name="name">MAP View</field>
            <field name="model">traktop</field>
            <field name="arch" type="xml">
                <form string="Map View" create="false" edit="false" delete="false" actions="false" readonly="1" class="hide-on-form">
                    <sheet>
                        <group>
                            <field name="delivery_address" widget="address_multiple_markers_gmap" readonly="1" nolabel="1"/>
                        </group>
                    </sheet>
                </form>
            </field>
        </record>

        <!-- Action to open the Map view in full window -->
        <record id="action_traktop_multiple_markers" model="ir.actions.act_window">
            <field name="name">Map</field>
            <field name="res_model">traktop</field>
            <field name="view_mode">form</field>
            <field name="view_id" ref="view_traktop_multiple_markers_form"/>
            <field name="target">current</field>
        </record>

        <!-- Menu Items -->
        <menuitem id="traktop_main_menu" name="Route Optimization" sequence="10" web_icon="mss_route_plan,static/description/icon.png"/>
        <menuitem id="traktop_menu" name="Delivery Orders" action="action_traktop" parent="traktop_main_menu"/>
        <menuitem id="menu_traktop_multiple_markers" name="Map View" parent="traktop_main_menu" action="action_traktop_multiple_markers" sequence="20"/>
        <menuitem id="menu_traktop_map_optimize" name="Optimization" parent="traktop_main_menu"
                  action="action_optimized_rec_created"/>
    </data>
</odoo>
